<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>首页</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">

	<link rel="stylesheet" href="css/style.min.css">

	<script src="js/jquery-2.1.3.min.js"></script>
	<script src="js/jquery.session.js"></script>
	<script src="js/common.js"></script>

	<script>
        $(function () {

            //如果session不为空，则直接到取号页面
			if($.session.get("token")){
                document.location = "qrcode.html";
			}

            //登陆按钮点击事件
			$("#login-btn").click(function () {

                //判断登陆名和密码是否为空
				var loginId = $("#login-id");
				var loginPwd = $("#login-pwd");
				if(!loginId.val()){
					alert("请输入帐号");
					loginId.focus();
					return;
				}
				if(!loginPwd.val()){
					alert("请输入密码");
					loginPwd.focus();
					return;
				}

                //防止重复点击
				$("#login-btn").attr("disabled", "disabled");
				$(this).html("登录中");

                //获取token
				getToken($(this));
			});
		});

        //获取token方法
		function getToken(obj) {
		
            //获取token需要传递的参数
			var jsondata = {
				DeviceNo: $("#login-id").val(),
				Secret: $("#login-pwd").val()
			};

            //接口地址
			var url = "/api/Token/GetToken";

            //获取成功后的回调方法
			var callback = function(result) {
				$.session.set("token",result);
                document.location = "qrcode.html";
			}

            //获取token请求
			$.Common.GetAjax(jsondata, url, callback, obj);
		};

	</script>
</head>

<body>
	<div class="index-bg">
		<div class="index-login">
			<input id="login-id" type="text" placeholder="请输入帐号">
			<input id="login-pwd" type="password" placeholder="请输入密码">
		</div>
		<div class="index-btn">
			<button id="login-btn">登录</button>
		</div>
	</div>
</body>
</html>